// client/src/auth/devLogin.js
import { setToken, setCampaignId } from "./token";

export async function devLogin({
  email = "dev@example.com",
  name = "Dev",
  campaignSlug = "demo-campaign",
  role = "owner",
} = {}) {
  const res = await fetch("/api/dev/login", {
    method: "POST",
    headers: { "content-type": "application/json" },
    body: JSON.stringify({ email, name, campaignSlug, role }),
  });

  // Handle both shapes: {token} or {token, campaign:{id}} etc.
  const data = await res.json();
  const token = data?.token || data?.accessToken || "";
  const campaignId =
    data?.campaignId ||
    data?.campaign?.id ||
    data?.membership?.campaign_id ||
    "";

  setToken(token);
  if (campaignId) setCampaignId(campaignId);

  return { token, campaignId };
}
